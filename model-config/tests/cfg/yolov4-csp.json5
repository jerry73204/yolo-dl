{
    "main_group": "YoloV4Csp",
    "groups": {
        // prefix of yolov4
        "Prefix": [
            {
                "name": "input",
                "kind": "Input",
                "shape": [3, "_", "_"],
            },
            {
                "from": "input",
                "kind": "ConvBn2D",
                "c": 32,
                "k": 3,
            },
            {
                "name": "fork",
                "kind": "ConvBn2D",
                "c": 64,
                "k": 3,
                "s": 2,
            },
            {
                "kind": "ConvBn2D",
                "c": 32,
                "k": 1,
            },
            {
                "name": "merge",
                "kind": "ConvBn2D",
                "c": 64,
                "k": 1,
            },
            {
                "kind": "Concat2D",
                "from": ["fork", "merge"]
            },
            {
                "name": "output",
                "kind": "DarkCsp2D",
                "c": 128,
                "repeat": 2,
            },
        ],

        // the yolov4-csp model
        "YoloV4Csp": [
            {
                "name": "input",
                "kind": "Input",
                "shape": [3, "_", "_"],
            },
            // initial layers, no forks
            {
                "name": "init",                
                "kind": "GroupRef",
                "from": {
                    "input": "input",
                },
                "group": "Prefix",
            },

            // (1, 1)
            {
                "name": "dark1",                
                "kind": "DarkCsp2D",
                "from": "init.prefix_output",
                "c": 256,
                "repeat": 8,
            },

            // (1, 2)
            {
                "name": "dark2",                
                "kind": "DarkCsp2D",
                "from": "dark1",
                "c": 512,
                "repeat": 8,
            },

            // (1, 3)
            {
                "name": "dark3",                
                "kind": "DarkCsp2D",
                "from": "dark2",
                "c": 1024,
                "repeat": 4,
            },


            // (2, 1)
            {
                "kind": "Concat2D",
                "from": ["dark1", "up2_up1"],
            },
            {
                "name": "up1",                
                "kind": "DarkCsp2D",
                "c": 128,
                "repeat": 2,
                "shortcut": false,
            },

            // (2, 2)
            {
                "kind": "Concat2D",
                "from": ["dark2", "up3_up2"],
            },
            {
                "name": "up2",                
                "kind": "DarkCsp2D",
                "c": 256,
                "repeat": 2,
                "shortcut": false,
            },

            // (2, 3)
            {
                "name": "up3",                
                "kind": "SppCsp2D",
                "from": "dark3",
                "c": 512,
                "k": [1, 5, 9, 13],
            },

            // (3, 2)
            {
                "kind": "Concat2D",
                "from": ["up2", "up1_down2"],
            },
            {
                "name": "down2",                
                "kind": "DarkCsp2D",
                "c": 256,
                "repeat": 2,
                "shortcut": false,
            },

            // (3, 3)
            {
                "kind": "Concat2D",
                "from": ["up3", "down2_down3"],
            },
            {
                "name": "down3",                
                "kind": "DarkCsp2D",
                "c": 512,
                "repeat": 2,
                "shortcut": false,
            },


            // (4, 1)
            {
                "name": "detect1",                
                "kind": "Detect2D",
                "from": "up1_detect1",
                "classes": 80,
                "anchors": [[12, 16], [19, 36], [40, 28]],
            },

            // [4, 2]
            {
                "name": "detect2",                
                "kind": "Detect2D",
                "from": "down2_detect2",
                "classes": 80,
                "anchors": [[36, 75], [76, 55], [72, 146]],
            },

            // [4, 3]
            {
                "name": "detect3",                
                "kind": "Detect2D",
                "from": "down3_detect3",
                "classes": 80,
                "anchors": [[142, 110], [192, 243], [459, 401]],
            },

            // (2, 3) -> (2, 2)
            {
                "kind": "ConvBn2D",
                "from": "up3",
                "c": 256,
                "k": 1,
            },
            {
                "name": "up3_up2",                
                "kind": "UpSample2D",
                "scale": 2.0,
            },

            // (2, 2) -> (2, 1)
            {
                "kind": "ConvBn2D",
                "from": "up2",
                "c": 128,
                "k": 1,
            },
            {
                "name": "up2_up1",                
                "kind": "UpSample2D",
                "scale": 2.0,
            },

            // (2, 1) -> (3, 2)
            {
                "name": "up1_down2",                
                "kind": "ConvBn2D",
                "from": "up1",
                "c": 256,
                "k": 3,
                "s": 2,
            },


            // (3, 2) -> (3, 3)
            {
                "name": "down2_down3",                
                "kind": "ConvBn2D",
                "from": "down2",
                "c": 512,
                "k": 3,
                "s": 2,
            },

            // (2, 1) -> (4, 1)
            {
                "kind": "ConvBn2D",
                "from": "up1",
                "c": 256,
                "k": 3,
                "s": 2,
            },
            {
                "name": "up1_detect1",                
                "kind": "ConvBn2D",
                "c": 255,
                "k": 1,
            },


            // (3, 2) -> (4, 2)
            {
                "kind": "ConvBn2D",
                "from": "down2",
                "c": 512,
                "k": 3,
                "s": 2,
            },
            {
                "name": "down2_detect2",                
                "kind": "ConvBn2D",
                "c": 255,
                "k": 1,
            },

            // (3, 3) -> (4, 3)
            {
                "kind": "ConvBn2D",
                "from": "down3",
                "c": 1024,
                "k": 3,
                "s": 2,
            },
            {
                "name": "down3_detect3",                
                "kind": "ConvBn2D",
                "c": 255,
                "k": 1,
            },

            // output
            {
                "name": "yolo",                
                "kind": "MergeDetect2D",
                "from": ["detect1", "detect2", "detect3"]
            },
        ]
    }
}
